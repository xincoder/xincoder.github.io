<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 3.0.0">
  <meta name="generator" content="Hugo 0.49.2" />
  <meta name="author" content="Xin Li">

  
  
  
  
    
  
  <meta name="description" content="Train a model to predict steering angles.">

  
  <link rel="alternate" hreflang="en-us" href="http://xincoder.github.io/project/selfdriving_drive_emulator/">

  


  

  

  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous">
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  <link rel="stylesheet" href="/styles.css">
  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-128386120-1', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  
  <link rel="alternate" href="http://xincoder.github.io/index.xml" type="application/rss+xml" title="Welcome to Xin&#39;s Homepage">
  <link rel="feed" href="http://xincoder.github.io/index.xml" type="application/rss+xml" title="Welcome to Xin&#39;s Homepage">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="http://xincoder.github.io/project/selfdriving_drive_emulator/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Welcome to Xin&#39;s Homepage">
  <meta property="og:url" content="http://xincoder.github.io/project/selfdriving_drive_emulator/">
  <meta property="og:title" content="Drive in An Emulator [Self Driving] | Welcome to Xin&#39;s Homepage">
  <meta property="og:description" content="Train a model to predict steering angles.">
  
  
    
  <meta property="og:image" content="http://xincoder.github.io/img/icon-192.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-08-03T00:00:00-07:00">
  
  <meta property="article:modified_time" content="2018-08-03T00:00:00-07:00">
  

  

  

  <title>Drive in An Emulator [Self Driving] | Welcome to Xin&#39;s Homepage</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >

<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Welcome to Xin&#39;s Homepage</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#publications">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#intern">
            
            <span>Internship</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#teaching">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/blogs/">
            
            <span>Blogs</span>
            
          </a>
        </li>

        
        

      

        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article article-project" itemscope itemtype="http://schema.org/Article">

  













<div class="article-header d-xl-none">
  <img src="/project/selfdriving_drive_emulator/featured_hu444c71b7a237f2ac4c47fed0963d3788_1018518_1600x400_fill_q90_box_center_2.png" class="article-banner" itemprop="image" alt="">
  
</div>


<div class="container-fluid split-header d-none d-xl-block">
  <div class="row">
    <div class="col-6">
      <div class="split-header-content">
        <h1 itemprop="name">Drive in An Emulator [Self Driving]</h1>

        

        

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Xin Li">
  </span>
  

  <span class="article-date">
    
    <meta content="2018-08-03 00:00:00 -0700 PDT" itemprop="datePublished">
    <time datetime="2018-08-03 00:00:00 -0700 PDT" itemprop="dateModified">
      Aug 3, 2018
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Xin Li">
  </span>

  

  
  

  

  

</div>


        
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Drive%20in%20An%20Emulator%20%5bSelf%20Driving%5d&amp;url=http%3a%2f%2fxincoder.github.io%2fproject%2fselfdriving_drive_emulator%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=http%3a%2f%2fxincoder.github.io%2fproject%2fselfdriving_drive_emulator%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fxincoder.github.io%2fproject%2fselfdriving_drive_emulator%2f&amp;title=Drive%20in%20An%20Emulator%20%5bSelf%20Driving%5d"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=http%3a%2f%2fxincoder.github.io%2fproject%2fselfdriving_drive_emulator%2f&amp;title=Drive%20in%20An%20Emulator%20%5bSelf%20Driving%5d"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Drive%20in%20An%20Emulator%20%5bSelf%20Driving%5d&amp;body=http%3a%2f%2fxincoder.github.io%2fproject%2fselfdriving_drive_emulator%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
    </div>
    <div class="col-6">
      <div class="split-header-image">
        <img src="/project/selfdriving_drive_emulator/featured_hu444c71b7a237f2ac4c47fed0963d3788_1018518_680x500_fill_q90_box_center_2.png" itemprop="image" alt="">
        
      </div>
    </div>
  </div>
</div>

<div class="article-container d-xl-none">
  <h1 itemprop="name">Drive in An Emulator [Self Driving]</h1>

  

  

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Xin Li">
  </span>
  

  <span class="article-date">
    
    <meta content="2018-08-03 00:00:00 -0700 PDT" itemprop="datePublished">
    <time datetime="2018-08-03 00:00:00 -0700 PDT" itemprop="dateModified">
      Aug 3, 2018
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Xin Li">
  </span>

  

  
  

  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Drive%20in%20An%20Emulator%20%5bSelf%20Driving%5d&amp;url=http%3a%2f%2fxincoder.github.io%2fproject%2fselfdriving_drive_emulator%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=http%3a%2f%2fxincoder.github.io%2fproject%2fselfdriving_drive_emulator%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fxincoder.github.io%2fproject%2fselfdriving_drive_emulator%2f&amp;title=Drive%20in%20An%20Emulator%20%5bSelf%20Driving%5d"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=http%3a%2f%2fxincoder.github.io%2fproject%2fselfdriving_drive_emulator%2f&amp;title=Drive%20in%20An%20Emulator%20%5bSelf%20Driving%5d"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Drive%20in%20An%20Emulator%20%5bSelf%20Driving%5d&amp;body=http%3a%2f%2fxincoder.github.io%2fproject%2fselfdriving_drive_emulator%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

</div>



  <div class="article-container">
    

    <div class="article-style" itemprop="articleBody">
      

<h1 id="drive-in-a-simulator"><strong>Drive in a simulator</strong></h1>

<p>Programming Language:</p>

<ul>
<li>Python</li>
</ul>













  


<video controls >
  <source src="demo.mp4" type="video/mp4">
</video>

<p>The goals of this project are the following:</p>

<ul>
<li>Use the simulator to collect data of good driving behavior</li>
<li>Build, a convolution neural network in Keras that predicts steering angles from images</li>
<li>Train and validate the model with a training and validation set</li>
<li>Test that the model successfully drives around track one without leaving the road</li>
<li>Summarize the results with a written report</li>
</ul>

<hr />

<h2 id="section-1-model-architecture-and-training-strategy">Section 1: Model Architecture and Training Strategy</h2>

<h3 id="1-model-architecture">1. Model architecture</h3>

<p>The following figure shows the architecture of my model.</p>

<ul>
<li>First, I normalized all pixels of an input frame to [-1, 1].</li>
<li>Second, I use Cropping2D to remove sky and the hood from every single frame.</li>
<li>Third, 3 (5x5) convolutional layers are used to extract visual features from input frame. All convolutional layers have a RELU activation function to introduce nonlinearity. Each convolutional layer is followed by a MaxPooling2D layer to reduce the size of feature maps.</li>
<li>Then, 1 flatten layer [model.py line 39] convert the feature maps to a vector and two fully connect layers are used to predict the final result.</li>
</ul>

<p>Predicting the angle of the steering wheel is a regression problem. Thus I used &ldquo;mse&rdquo; loss function.</p>

<p><img src="sd.jpg" alt="sd.jpg" /></p>

<h3 id="2-attempts-to-reduce-overfitting-in-the-model">2. Attempts to reduce overfitting in the model</h3>

<ul>
<li><strong>Dropout:</strong> The model contains dropout layers in order to reduce overfitting.</li>
<li><strong>Data collection:</strong> On both tracks, I drive the car Clockwise (2 loops) and counterclockwise (1 loop) and save data.</li>
<li><strong>Training:</strong> The model was trained and validated on different data sets to ensure that the model was not overfitting. The model was tested by running it through the simulator and ensuring that the vehicle could stay on the track.</li>
<li><strong>Data Augmentation:</strong> Every training frame has 50% probability to be horizontally flipped during training.</li>
</ul>

<h3 id="3-model-parameter-tuning">3. Model parameter tuning</h3>

<p>The model used an adam optimizer, so the learning rate was not tuned manually.</p>

<h3 id="4-appropriate-training-data">4. Appropriate training data</h3>

<p>Training data was chosen to keep the vehicle driving on the road. I used a combination of center lane driving, recovering from the left and right sides of the road. Based on the ground truth:</p>

<ul>
<li>If the current angle is 0, then the correction value for data from the left and right camera is set to a small value.</li>
<li>Otherwise, a larger correction value is used.
Using this way can avoid the car from performing as a snake.</li>
</ul>

<p>All data are randomly split into two subsets: 80% for training and 20% for validation. The model normalized input to [-1, 1] and crop out the top and the bottom parts to remove meaningless context.</p>

<p>The following two figures are the original input and the result after cropped.</p>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center"></th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">Original Input</td>
<td align="center">Cropped Input</td>
</tr>

<tr>
<td align="center"><img src="original.jpg" alt="original.jpg" /></td>
<td align="center"><img src="crop.jpg" alt="crop.jpg" /></td>
</tr>
</tbody>
</table>

<p>The following shows the number of collected data. As you can see that, after using data from all 3 cameras and randomly horizontally flip frames, the distributation of the data is more balance.</p>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center"></th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">Raw Data</td>
<td align="center">Use all 3 cameras &amp; Data Augmentation</td>
</tr>

<tr>
<td align="center"><img src="ori_dist.png" alt="ori_dist.png" /></td>
<td align="center"><img src="aug_dist.png" alt="aug_dist.png" /></td>
</tr>
</tbody>
</table>

<hr />

<h2 id="section-3-training-history-and-model-visualization">Section 3: Training History and Model Visualization</h2>

<p>This figure shows the loss history during training.
<img src="loss.png" alt="loss.png" /></p>

<p>I also visulized the trained model and tried to understand what features the model learned.
<img src="vis.jpg" alt="vis.jpg" /></p>

<hr />

<h2 id="section-4-conclusion-and-future-work">Section 4: Conclusion and Future work</h2>

<p>In this project, I proposed a Convolutional Network to predict the angle of the steering wheel running in an emulator.</p>

<p>The trained model successful negatives the car. Even in the second track (more challenging than the first one), the model still performs great.</p>

<p>One of the possible drawback of the current model is taht it was only trained on the data collected from 2 tracks. Thus, it may cannot perform perfectly in other unseen scenario.</p>

<p>Thus, in the future, I would like to train the model using more data collected from different scens.</p>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/self-driving/">Self Driving</a>
  
  <a class="badge badge-light" href="/tags/python/">Python</a>
  
</div>



    






<div class="media author-card" itemscope itemtype="http://schema.org/Person">
  
  <img class="portrait mr-3" src="/img/portrait.jpg" itemprop="image" alt="Avatar">
  
  <div class="media-body">
    <h5 class="card-title" itemprop="name"><a href="/">Xin Li</a></h5>
    <h6 class="card-subtitle">Senior Machine Learning Engineer</h6>
    
    <ul class="network-icon" aria-hidden="true">
      
      
      
      
      <li>
        <a itemprop="sameAs" href="files/cv.pdf" target="_blank" rel="noopener">
          <i class="ai ai-cv"></i>
        </a>
      </li>
      
    </ul>
  </div>
</div>




    
    
    
    
    
    
    
    
    

    

  </div>
</article>



<div class="container">
  <footer class="site-footer">
  

  <p class="powered-by">
    &copy; 2018 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
    

    <script src="/js/hugo-academic.js"></script>
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "Search Results",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    

    
    

    
    

  </body>
</html>

